{"version":3,"file":"useDomChangesObserver.mjs","sources":["../../../../../src/composables/useElementBackground/useDomChangesObserver.ts"],"sourcesContent":["import { onBeforeUnmount, onMounted, Ref } from 'vue'\n\ntype Handler = { cb: (() => void), el: Ref<HTMLElement | undefined> }\n\nlet observer: MutationObserver | null\nlet callbacks: Handler[] = []\n\nconst createMutationObserver = () => {\n  const runCallbacks = (mutations: MutationRecord[]) => {\n    for (let i = 0; i < callbacks.length; i++) {\n      if (mutations.some((m) => m.target.contains(callbacks[i].el.value || null))) {\n        callbacks[i].cb()\n      }\n    }\n  }\n\n  if (!observer) {\n    observer = new MutationObserver((mutations) => {\n      runCallbacks(mutations)\n    })\n    observer.observe(document.documentElement, {\n      attributeFilter: ['style', 'class'],\n      subtree: true,\n      attributes: true,\n    })\n  }\n}\n\nconst destroyMutationObserver = () => {\n  if (!observer) { return }\n\n  if (callbacks.length > 0) { return }\n  observer.disconnect()\n  observer = null\n}\n\n/** Creates on global watched for dom changes */\nexport const useDomChangesObserver = (cb: () => void, el: Ref<HTMLElement | undefined>) => {\n  onMounted(() => {\n    createMutationObserver()\n    callbacks.push({ cb, el })\n  })\n\n  onBeforeUnmount(() => {\n    callbacks = callbacks.filter((c) => c.cb !== cb)\n    destroyMutationObserver()\n  })\n}\n"],"names":[],"mappings":";AAIA,IAAI;AACJ,IAAI,YAAuB,CAAA;AAE3B,MAAM,yBAAyB,MAAM;AAC7B,QAAA,eAAe,CAAC,cAAgC;AACpD,aAAS,IAAI,GAAG,IAAI,UAAU,QAAQ,KAAK;AACzC,UAAI,UAAU,KAAK,CAAC,MAAM,EAAE,OAAO,SAAS,UAAU,GAAG,GAAG,SAAS,IAAI,CAAC,GAAG;AAC3E,kBAAU,GAAG;MACf;AAAA,IACF;AAAA,EAAA;AAGF,MAAI,CAAC,UAAU;AACF,eAAA,IAAI,iBAAiB,CAAC,cAAc;AAC7C,mBAAa,SAAS;AAAA,IAAA,CACvB;AACQ,aAAA,QAAQ,SAAS,iBAAiB;AAAA,MACzC,iBAAiB,CAAC,SAAS,OAAO;AAAA,MAClC,SAAS;AAAA,MACT,YAAY;AAAA,IAAA,CACb;AAAA,EACH;AACF;AAEA,MAAM,0BAA0B,MAAM;AACpC,MAAI,CAAC,UAAU;AAAE;AAAA,EAAO;AAEpB,MAAA,UAAU,SAAS,GAAG;AAAE;AAAA,EAAO;AACnC,WAAS,WAAW;AACT,aAAA;AACb;AAGa,MAAA,wBAAwB,CAAC,IAAgB,OAAqC;AACzF,YAAU,MAAM;AACS;AACvB,cAAU,KAAK,EAAE,IAAI,GAAI,CAAA;AAAA,EAAA,CAC1B;AAED,kBAAgB,MAAM;AACpB,gBAAY,UAAU,OAAO,CAAC,MAAM,EAAE,OAAO,EAAE;AACvB;EAAA,CACzB;AACH;;"}